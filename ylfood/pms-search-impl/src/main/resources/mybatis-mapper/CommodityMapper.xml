<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.spfood.pms.search.intf.domain.Commodity" >
  <resultMap id="BaseResultMap" type="com.spfood.pms.search.intf.domain.Commodity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="commodity_code" property="commodityCode" jdbcType="VARCHAR" />
    <result column="commodity_gs1_code" property="commodityGs1Code" jdbcType="VARCHAR" />
    <result column="category_code" property="category.categoryCode" jdbcType="VARCHAR" />
    <result column="product_code" property="product.productCode" jdbcType="VARCHAR" />
    <result column="commodity_name" property="commodityName" jdbcType="VARCHAR" />
    <result column="commodity_show_name" property="commodityShowName" jdbcType="VARCHAR" />
    <result column="commodity_city" property="commodityCity" jdbcType="VARCHAR" />
    <result column="commodity_price" property="commodityPrice" jdbcType="REAL" />
    <result column="commodity_sales_price" property="commoditySalesPrice" jdbcType="REAL" />
    <result column="image_url" property="imageUrl" jdbcType="VARCHAR" />
    <result column="sales_amount" property="salesAmount" jdbcType="INTEGER" />
    <result column="commodity_product_quantity" property="commodityProductQuantity" jdbcType="INTEGER" />
    <result column="default_flag" property="defaultFlag" jdbcType="INTEGER" />
    <result column="commodity_weight_unit" property="commodityWeightUnit" jdbcType="VARCHAR" />
    <result column="commodity_show_place" property="commodityShowPlace" jdbcType="VARCHAR" />
    <result column="commodity_comment" property="commodityComment" jdbcType="VARCHAR" />
    <result column="commodity_weight" property="commodityWeight" jdbcType="DOUBLE" />
    <result column="commodity_quantity" property="commodityQuantity" jdbcType="INTEGER" />
    <result column="commodity_status" property="commodityStatus" jdbcType="INTEGER" />
    <result column="product_temperature_zone_name" property="productTemperatureZoneName" jdbcType="VARCHAR" />
    <result column="product_temperature_zone_code" property="productTemperatureZoneCode" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="create_user" property="createUser" jdbcType="VARCHAR" />
    <result column="last_update_date" property="lastUpdateDate" jdbcType="TIMESTAMP" />
    <result column="last_update_user" property="lastUpdateUser" jdbcType="VARCHAR" />
    <result column="category_name" property="category.categoryName" jdbcType="VARCHAR" />
    <result column="product_specification_value" property="product.productSpecificationValue" jdbcType="FLOAT" />
    <result column="product_specification_unit_first" property="product.productSpecificationUnitFirst" jdbcType="VARCHAR" />
    <result column="product_specification_unit_second" property="product.productSpecificationUnitSecond" jdbcType="VARCHAR" />
    
    <collection property="commodityPropertys" ofType="com.spfood.pms.search.intf.domain.CommodityProperty">
        <id column="cid" property="id" jdbcType="BIGINT" />
	    <result column="commdity_code" property="commodityCode" jdbcType="VARCHAR" />
	    <result column="commdity_property_name" property="commdityPropertyName" jdbcType="VARCHAR" />
	    <result column="commdity_property_value" property="commdityPropertyValue" jdbcType="VARCHAR" />
    </collection>
    
  </resultMap>
  
  <resultMap id="commodity_picture" type="com.spfood.pms.search.intf.domain.Commodity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="commodity_code" property="commodityCode" jdbcType="VARCHAR" />
    <result column="commodity_gs1_code" property="commodityGs1Code" jdbcType="VARCHAR" />
    <result column="category_code" property="category.categoryCode" jdbcType="VARCHAR" />
    <result column="product_code" property="product.productCode" jdbcType="VARCHAR" />
    <result column="category_name" property="category.categoryName" jdbcType="VARCHAR" />
    <result column="commodity_name" property="commodityName" jdbcType="VARCHAR" />
    <result column="commodity_show_name" property="commodityShowName" jdbcType="VARCHAR" />
    <result column="commodity_city" property="commodityCity" jdbcType="VARCHAR" />
    <result column="commodity_price" property="commodityPrice" jdbcType="REAL" />
    <result column="commodity_sales_price" property="commoditySalesPrice" jdbcType="REAL" />
    <result column="sales_amount" property="salesAmount" jdbcType="INTEGER" />
    <result column="commodity_product_quantity" property="commodityProductQuantity" jdbcType="INTEGER" />
    <result column="default_flag" property="defaultFlag" jdbcType="INTEGER" />
    <result column="commodity_weight_unit" property="commodityWeightUnit" jdbcType="VARCHAR" />
    <result column="commodity_show_place" property="commodityShowPlace" jdbcType="VARCHAR" />
    <result column="commodity_comment" property="commodityComment" jdbcType="VARCHAR" />
    <result column="commodity_weight" property="commodityWeight" jdbcType="DOUBLE" />
    <result column="commodity_quantity" property="commodityQuantity" jdbcType="INTEGER" />
    <result column="commodity_status" property="commodityStatus" jdbcType="INTEGER" />
    
    <collection property="commodityPictures" ofType="com.spfood.pms.search.intf.domain.CommodityPicture">
        <id column="pid" property="id" jdbcType="BIGINT" />
	    <result column="picture_show_position" property="pictureShowPosition" jdbcType="VARCHAR" />
	    <result column="picture_show_order" property="pictureShowOrder" jdbcType="VARCHAR" />
	    <result column="picture_url" property="pictureUrl" jdbcType="VARCHAR" />
    </collection>
    
  </resultMap>
  
  <sql id="Base_Column_List" >
    id, commodity_code, commodity_gs1_code, category_code, product_code, commodity_name,commodity_city, 
    commodity_comment,commodity_weight,commodity_weight_unit,commodity_show_place,commodity_product_quantity,
    commodity_city,
    commodity_show_name, commodity_price, commodity_sales_price, sales_amount, default_flag, 
    commodity_quantity, commodity_status, create_date, create_user, last_update_date, 
    last_update_user
  </sql>
  <sql id="Base_Where_Case" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where >
      <if test="id != null" >
         AND id = #{id,jdbcType=BIGINT}
      </if>
      <if test="commodityCode != null" >
         AND commodity_code = #{commodityCode,jdbcType=VARCHAR}
      </if>
      <if test="commodityGs1Code != null" >
         AND commodity_gs1_code = #{commodityGs1Code,jdbcType=VARCHAR}
      </if>
      <if test="categoryCode != null" >
         AND category_code = #{categoryCode,jdbcType=VARCHAR}
      </if>
      <if test="productCode != null" >
         AND product_code = #{productCode,jdbcType=VARCHAR}
      </if>
      <if test="commodityName != null" >
         AND commodity_name = #{commodityName,jdbcType=VARCHAR}
      </if>
      <if test="commodityShowName != null" >
         AND commodity_show_name = #{commodityShowName,jdbcType=VARCHAR}
      </if>
      <if test="commodityPrice != null" >
         AND commodity_price = #{commodityPrice,jdbcType=REAL}
      </if>
      <if test="commoditySalesPrice != null" >
         AND commodity_sales_price = #{commoditySalesPrice,jdbcType=REAL}
      </if>
      <if test="salesAmount != null" >
         AND sales_amount = #{salesAmount,jdbcType=INTEGER}
      </if>
      <if test="defaultFlag != null" >
         AND default_flag = #{defaultFlag,jdbcType=INTEGER}
      </if>
      <if test="commodityQuantity != null" >
         AND commodity_quantity = #{commodityQuantity,jdbcType=INTEGER}
      </if>
      <if test="commodityStatus != null" >
         AND commodity_status = #{commodityStatus,jdbcType=INTEGER}
      </if>
      <if test="createDate != null" >
         AND create_date = #{createDate,jdbcType=TIMESTAMP}
      </if>
      <if test="createUser != null" >
         AND create_user = #{createUser,jdbcType=VARCHAR}
      </if>
      <if test="lastUpdateDate != null" >
         AND last_update_date = #{lastUpdateDate,jdbcType=TIMESTAMP}
      </if>
      <if test="lastUpdateUser != null" >
         AND last_update_user = #{lastUpdateUser,jdbcType=VARCHAR}
      </if>
    </where>
  </sql>
  <select id="selectCount" resultType="java.lang.Long" parameterType="com.spfood.pms.search.intf.domain.Commodity" >
    select count( id)
     from pms_commodity
    <include refid="Base_Where_Case" />
  </select>
  <select id="selectByProductCode" resultMap="BaseResultMap" parameterType="java.lang.String">
      select 	id,
      			commodity_code,
      			commodity_gs1_code,
      			commodity_name,
      			commodity_show_name,
      			commodity_status,
      			commodity_quantity,
      			commodity_weight,
      			commodity_weight_unit,
      			commodity_show_place
      from pms_commodity 
      where product_code = #{productCode,jdbcType=VARCHAR} 
      		and commodity_status=3 
  </select>
  
  <select id="selectByPage" resultMap="BaseResultMap" parameterType="com.spfood.pms.search.intf.domain.Commodity" >
		select id from( 
		
		select pms_commodity.id as id
			from 		pms_commodity 
			left join   pms_product_category on pms_commodity.category_code = pms_product_category.category_code
			where 1=1 
				<if test="commodityStatus != null" >
		         	AND pms_commodity.commodity_status = #{commodityStatus}
		        </if>
		        <if test="commodityShowPlace != null" >
		            AND pms_commodity.commodity_show_place = #{commodityShowPlace}
		        </if>
				<if test="category != null and category.categoryCode != null" >
		            AND pms_commodity.category_code like #{category.categoryCode,jdbcType=VARCHAR} '%'
		        </if>
		        <if test="keywords != null" >
			      	<foreach item="item" index="index" collection="keywords" >
					 	and(
						  pms_commodity.commodity_name like '%' #{item,jdbcType=VARCHAR} '%'
						  or
						  pms_commodity.search_property like '%:' #{item,jdbcType=VARCHAR} '%'
						  or
						  pms_product_category.category_name like '%' #{item,jdbcType=VARCHAR} '%'
						  or
						  pms_product_category.category_another_name like '%' #{item,jdbcType=VARCHAR} '%'
						  ) 
					</foreach>
		        </if>
		        <if test="commodityPropertys != null" >
				      <foreach item="item" index="index" collection="commodityPropertys">
						 and pms_commodity.search_property like #{item.commdityPropertyName,jdbcType=VARCHAR}
					 </foreach>
		        </if>
	      GROUP BY pms_commodity.id
				<if test="orderBys == null" >
				    order by id desc
				</if>
			 	<if test="orderBys == 0" >
			        order by pms_commodity.sales_amount desc,pms_commodity.commodity_sales_price asc
		        </if>
		      	<if test="orderBys == 1" >
			     	order by pms_commodity.commodity_sales_price asc
		      	</if>
		      	<if test="orderBys == 2" >
			     	order by pms_commodity.commodity_sales_price desc
		      	</if>
		      	<if test="orderBys == 3" >
			    	order by pms_commodity.sales_amount asc
		      	</if>
		      	<if test="orderBys == 4" >
			     	order by pms_commodity.sales_amount desc
		      	</if>
		      ) as tempCommodity
  </select>
  
  	<select id="selectListByIds" resultMap="commodity_picture" parameterType="java.util.List">
	 select		pms_commodity.id,
				pms_commodity.commodity_code,
    		  	pms_commodity.category_code,
				pms_commodity.commodity_name,
				pms_commodity.commodity_status,
				pms_commodity.product_code,
			    pms_commodity.commodity_comment,
			    pms_commodity.commodity_price,
			    pms_commodity.commodity_sales_price,
			     pms_commodity.sales_amount,
			    pms_commodity.commodity_weight_unit,
			    pms_commodity.commodity_product_quantity,
			    pms_commodity.commodity_gs1_code,
			    pms_commodity.commodity_weight,
			    pms_commodity.commodity_quantity,
			    pms_commodity.commodity_show_place,
			    pms_commodity.commodity_city,
			    pms_commodity.product_temperature_zone_code,
			    pms_commodity.product_temperature_zone_name,
				pms_commodity_picture.id as pid,
				pms_commodity_picture.picture_show_position,
				pms_commodity_picture.picture_show_order,
				pms_commodity_picture.picture_url 
		from  pms_commodity 
		left join  pms_commodity_picture on pms_commodity_picture.commodity_code = pms_commodity.commodity_code
		where      pms_commodity.id in
					<foreach item="item" index="index" collection="list" open="("
						separator="," close=")">
						#{item}
					</foreach> 
		order by  pms_commodity.id desc,
				  pms_commodity_picture.picture_show_position asc,
				  pms_commodity_picture.picture_show_order asc
	</select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
		SELECT
			pms_commodity.id,
			pms_commodity.commodity_code,
			pms_commodity.commodity_name,
			pms_commodity.commodity_status,
			pms_commodity.product_code,
			pms_commodity.commodity_comment,
			pms_commodity.commodity_price,
			pms_commodity.commodity_sales_price,
			pms_commodity.commodity_weight_unit,
			pms_commodity.commodity_product_quantity,
			pms_commodity.commodity_gs1_code,
			pms_commodity.default_flag,
			pms_commodity.commodity_weight,
			pms_commodity.commodity_quantity,
			pms_commodity.commodity_show_place,
			pms_commodity.commodity_city,
		    pms_commodity.product_temperature_zone_code,
		    pms_commodity.product_temperature_zone_name,
			pms_commodity_property.id AS cid,
			pms_commodity_property.commdity_property_name,
			pms_commodity_property.commdity_property_value,
			pms_product.product_specification_value,
			pms_product.product_specification_unit_first,
			pms_product.product_specification_unit_second
		FROM
			pms_commodity
		LEFT JOIN pms_commodity_property ON pms_commodity_property.commdity_code = pms_commodity.commodity_code
		LEFT JOIN pms_product ON pms_product.product_code = pms_commodity.product_code
		WHERE
			pms_commodity.commodity_code = #{commodityCode,jdbcType=VARCHAR}
  </select>
  
  <select id="selectByCodelist" resultMap="BaseResultMap" parameterType="java.util.List" >
    select    pms_commodity.id,
    		  pms_commodity.commodity_code,
    		  pms_commodity.category_code,
    		  pms_commodity.commodity_name,
    		  pms_commodity.commodity_status,
    		  pms_commodity.product_code,
			  pms_commodity.commodity_comment,
			  pms_commodity.commodity_price,
			  pms_commodity.commodity_sales_price,
			  pms_commodity.commodity_weight_unit,
			  pms_commodity.commodity_product_quantity,
			  pms_commodity.commodity_gs1_code,
			  pms_commodity.default_flag,
			  pms_commodity.commodity_weight,
			  pms_commodity.commodity_quantity,
			  pms_commodity.commodity_show_place,
			  pms_commodity.commodity_city,
		      pms_commodity.product_temperature_zone_code,
		      pms_commodity.product_temperature_zone_name,
			  pms_commodity_property.id as cid,
			  pms_commodity_property.commdity_property_name,
			  pms_commodity_property.commdity_property_value,
			  pms_commodity_picture.picture_url as image_url,
			  pms_product_category.category_name
    from pms_commodity 
    left join pms_commodity_picture on pms_commodity.commodity_code = pms_commodity_picture.commodity_code 
    left join pms_product_category on pms_commodity.category_code = pms_product_category.category_code
    left join pms_commodity_property on pms_commodity_property.commdity_code = pms_commodity.commodity_code
    where     pms_commodity_picture.picture_show_order = 0
    	  and pms_commodity_picture.picture_show_position = 0
    	  <if test="list != null and list.size() > 0" >
				and pms_commodity.commodity_code  in (
    		<foreach item="item" index="index" collection="list"  separator=",">
				#{item}
			</foreach>
			 )
		  </if>
  </select>
  
  
  <select id="selectByPageApp" resultMap="BaseResultMap" parameterType="com.spfood.pms.search.intf.domain.Commodity" >
		select id from( 
		
		select pms_commodity.id as id
			from 		pms_commodity 
			left join   pms_product_category on pms_commodity.category_code = pms_product_category.category_code
			where 1=1 
				<if test="commodityStatus != null" >
		         	AND pms_commodity.commodity_status = #{commodityStatus}
		        </if>
		        <if test="commodityShowPlace != null" >
		            AND pms_commodity.commodity_show_place = #{commodityShowPlace}
		        </if>
				<if test="category != null and category.categoryCode != null" >
		            AND pms_commodity.category_code like #{category.categoryCode,jdbcType=VARCHAR}
		        </if>
	      GROUP BY pms_commodity.id
				    order by id desc
		      ) as tempCommodity
  </select>

    <select id="selectByCodelistAndStatus" resultMap="BaseResultMap" parameterType="com.spfood.pms.search.intf.domain.criteria.Parameters" >
    select    pms_commodity.id,
    		  pms_commodity.commodity_code,
    		  pms_commodity.category_code,
    		  pms_commodity.commodity_name,
    		  pms_commodity.commodity_status,
    		  pms_commodity.product_code,
			  pms_commodity.commodity_comment,
			  pms_commodity.commodity_price,
			  pms_commodity.commodity_sales_price,
			  pms_commodity.commodity_weight_unit,
			  pms_commodity.commodity_product_quantity,
			  pms_commodity.commodity_gs1_code,
			  pms_commodity.default_flag,
			  pms_commodity.commodity_weight,
			  pms_commodity.commodity_quantity,
			  pms_commodity.commodity_show_place,
			  pms_commodity.commodity_city,
		      pms_commodity.product_temperature_zone_code,
		      pms_commodity.product_temperature_zone_name,
			  pms_commodity_property.id as cid,
			  pms_commodity_property.commdity_property_name,
			  pms_commodity_property.commdity_property_value,
			  pms_commodity_picture.picture_url as image_url,
			  pms_product_category.category_name
    from pms_commodity 
    left join pms_commodity_picture on pms_commodity.commodity_code = pms_commodity_picture.commodity_code 
    left join pms_product_category on pms_commodity.category_code = pms_product_category.category_code
    left join pms_commodity_property on pms_commodity_property.commdity_code = pms_commodity.commodity_code
    where     pms_commodity_picture.picture_show_order = 0
    	  and pms_commodity_picture.picture_show_position = 0
    	  and pms_commodity.commodity_status = #{integerParameters,jdbcType=INTEGER}
    	  and pms_commodity.commodity_code in
    		<foreach item="item" index="index" collection="listParameters" open="(" separator="," close=")">
				#{item,jdbcType=VARCHAR}
			</foreach>
  </select>
  
  
  <select id="selectPriceByCodelist" resultMap="BaseResultMap" parameterType="java.util.List" >
    select pms_commodity.commodity_price,
			  pms_commodity.commodity_sales_price
    from pms_commodity 
    where commodity_code  in (
    		<foreach item="item" index="index" collection="list"  separator=",">
				#{item}
			</foreach>
			 )
  </select>
</mapper>